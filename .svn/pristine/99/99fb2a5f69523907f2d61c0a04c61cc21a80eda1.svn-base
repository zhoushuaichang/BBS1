package com.shinow.actions;

import java.util.Map;

import javax.annotation.Resource;

import org.springframework.stereotype.Service;

import com.opensymphony.xwork2.ActionContext;
import com.opensymphony.xwork2.ActionSupport;
import com.shinow.dao.UserInfoDAO;
import com.shinow.model.UserInfo;
@Service
public class RegLoginAction extends ActionSupport {

	private static final long serialVersionUID = 1L;
	@Resource
	private UserInfoDAO dao;
	private String userpass1;
	private UserInfo user;

	public String checklogin(){
	
		user.setUserName("12");
		user.setUserPass("121");
		
		if((user.getUserName()==null)||(user.getUserName().trim().length()<1)){
			this.addFieldError("errorField", "用户名不能为空");
			return INPUT;
		}
		if((user.getUserPass()==null)||(user.getUserPass().trim().length()<1)){
			this.addFieldError("errorField", "密码不能为空!");
			return INPUT;
		}
				
		UserInfo jk=dao.querylogin(user);
		if(jk==null){
			this.addFieldError("errorfield", "登录名或密码错误!");
			return INPUT;
		}else{
			
			Map<String,Object> session=(Map<String,Object>)ActionContext.getContext().getSession();
	//		Map<String,Object> request=(Map<String,Object>)ActionContext.getContext().get("reuqest");
			session.put("current_userinfo","user");
			return "login";
		
		}   
	}
		
		public String regblog(){
			user.setUserName("asd");
			UserInfo aa=dao.querylogin(user);
			if((user.getUserName()==null)||(user.getUserName().trim().length()==0)){
				this.addFieldError("user.userName", "用户不能为空！请重新输入！");
			}
			if(aa!=null){
				this.addFieldError("user.userName","用户名已存在!请重新输入！");
				return INPUT;
			}    
			if((user.getUserPass()==null)||(user.getUserPass().trim().length()<1)){
				this.addFieldError("user.userPass", "登陆密码不能为空!");
				return INPUT;
			}
			if(!user.getUserPass().equals(userpass1)){
				this.addFieldError("userpass1","两次密码不一致！");
				return INPUT;
			}
			
			if(this.hasErrors()==true){
				return INPUT;
				}
			
			else{
				
				if(true==dao.userinset(user)){
					return SUCCESS;		
				}else{
					return INPUT;
				}
				
			}
			
			
		}
	public UserInfoDAO getDao() {
		return dao;
	}
	public UserInfo getUser() {
		return user;
	}
	public void setUser(UserInfo user) {
		this.user = user;
	}
}
